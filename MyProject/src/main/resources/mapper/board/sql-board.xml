<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.inhatc.spring.myproject.board.mapper.BoardMapper">
    <select id="boardList" resultType="kr.inhatc.spring.myproject.board.dto.BoardDto">
        SELECT board_idx, title, hit_cnt, DATE_FORMAT(create_datetime, '%Y-%m-%d') AS create_datetime
        FROM T_BOARD
        WHERE delete_yn = 'N'
        ORDER BY board_idx DESC
    </select>

    <insert id="boardInsert" parameterType="kr.inhatc.spring.myproject.board.dto.BoardDto">
        # 시퀀스 값 가져오기
<!--        <selectKey keyProperty="boardIdx" resultType="int" order="BEFORE">-->
<!--            SELECT board_seq.nextval FROM dual-->
<!--        </selectKey>-->
        INSERT INTO T_BOARD(title, contents, create_datetime, creator_id)
        VALUES (#{title}, #{contents}, sysdate(), 'admin')
    </insert>

    <select id="boardDetail" parameterType="int" resultType="kr.inhatc.spring.myproject.board.dto.BoardDto">
        SELECT board_idx, title, contents, hit_cnt, DATE_FORMAT(create_datetime, '%Y-%m-%d') AS create_datetime, creator_id
        FROM T_BOARD
        WHERE delete_yn = 'N' AND board_idx = #{boardIdx}
    </select>

    <update id="boardUpdate" parameterType="kr.inhatc.spring.myproject.board.dto.BoardDto">
        UPDATE T_BOARD
        SET title           = #{title},
            contents        = #{contents},
            create_datetime = SYSDATE(),
            creator_id      = 'admin'
        WHERE board_idx = #{boardIdx};
    </update>

    <update id="updateHit" parameterType="int">
        UPDATE T_BOARD
        SET hit_cnt = hit_cnt + 1
        WHERE board_idx = #{boardIdx};
    </update>

<!--    <delete id="boardDelete" parameterType="int">-->
<!--        DELETE FROM T_BOARD-->
<!--        WHERE board_idx = #{boardIdx};-->
<!--    </delete>-->

    <update id="boardDelete" parameterType="int">
        UPDATE T_BOARD
        SET delete_yn = 'Y'
        WHERE board_idx = #{boardIdx};
    </update>
</mapper>
